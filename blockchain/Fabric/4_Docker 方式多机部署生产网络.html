<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>使用 Docker 部署生产网络 | XzXie&#39;s docs</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="notes, blogs, share">
    
    <link rel="preload" href="/assets/css/0.styles.9f84806b.css" as="style"><link rel="preload" href="/assets/js/app.d06c6709.js" as="script"><link rel="preload" href="/assets/js/2.58244656.js" as="script"><link rel="preload" href="/assets/js/1.6ba70183.js" as="script"><link rel="preload" href="/assets/js/29.f41b1a18.js" as="script"><link rel="prefetch" href="/assets/js/10.0720960b.js"><link rel="prefetch" href="/assets/js/11.2a97faa3.js"><link rel="prefetch" href="/assets/js/12.6b9ed61d.js"><link rel="prefetch" href="/assets/js/13.ebfb1f42.js"><link rel="prefetch" href="/assets/js/14.3e65117c.js"><link rel="prefetch" href="/assets/js/15.2d87bde7.js"><link rel="prefetch" href="/assets/js/16.9ca9aae8.js"><link rel="prefetch" href="/assets/js/17.3dbcb51f.js"><link rel="prefetch" href="/assets/js/18.4c170722.js"><link rel="prefetch" href="/assets/js/19.d8afd0ae.js"><link rel="prefetch" href="/assets/js/20.10e47ab9.js"><link rel="prefetch" href="/assets/js/21.0ad1d6a3.js"><link rel="prefetch" href="/assets/js/22.b7c97fbe.js"><link rel="prefetch" href="/assets/js/23.4d1da05b.js"><link rel="prefetch" href="/assets/js/24.f6864778.js"><link rel="prefetch" href="/assets/js/25.75176990.js"><link rel="prefetch" href="/assets/js/26.59fe80a5.js"><link rel="prefetch" href="/assets/js/27.a811c9bb.js"><link rel="prefetch" href="/assets/js/28.6b59eb8d.js"><link rel="prefetch" href="/assets/js/3.bc6bba9e.js"><link rel="prefetch" href="/assets/js/30.487fc7a2.js"><link rel="prefetch" href="/assets/js/31.3548df4f.js"><link rel="prefetch" href="/assets/js/32.a77f1645.js"><link rel="prefetch" href="/assets/js/33.0d7de458.js"><link rel="prefetch" href="/assets/js/34.c598fd10.js"><link rel="prefetch" href="/assets/js/35.79c21276.js"><link rel="prefetch" href="/assets/js/36.1454edc2.js"><link rel="prefetch" href="/assets/js/37.ca307149.js"><link rel="prefetch" href="/assets/js/38.7119b7a7.js"><link rel="prefetch" href="/assets/js/39.93ec7e0b.js"><link rel="prefetch" href="/assets/js/4.45665f8a.js"><link rel="prefetch" href="/assets/js/40.fd10051f.js"><link rel="prefetch" href="/assets/js/5.7098d77a.js"><link rel="prefetch" href="/assets/js/6.0c0a0f39.js"><link rel="prefetch" href="/assets/js/7.6a854e57.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.5e19b665.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9f84806b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/img/logo.png" alt="XzXie's docs" class="logo"> <span class="site-name can-hide">XzXie's docs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="区块链" class="dropdown-title"><span class="title">区块链</span> <span class="arrow down"></span></button> <button type="button" aria-label="区块链" class="mobile-dropdown-title"><span class="title">区块链</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blockchain/BTC/比特币与区块链.html" class="nav-link">
  比特币
</a></li><li class="dropdown-item"><!----> <a href="/blockchain/ETH/部署以太坊私链.html" class="nav-link">
  以太坊
</a></li><li class="dropdown-item"><!----> <a href="/blockchain/Fabric/1_部署 Fabric 生产网络.html" class="nav-link">
  Fabric
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front-end/Vue/Vue2.html" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/front-end/VuePress/VuePress项目部署.html" class="nav-link">
  VuePress
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/xBeTe" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="区块链" class="dropdown-title"><span class="title">区块链</span> <span class="arrow down"></span></button> <button type="button" aria-label="区块链" class="mobile-dropdown-title"><span class="title">区块链</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blockchain/BTC/比特币与区块链.html" class="nav-link">
  比特币
</a></li><li class="dropdown-item"><!----> <a href="/blockchain/ETH/部署以太坊私链.html" class="nav-link">
  以太坊
</a></li><li class="dropdown-item"><!----> <a href="/blockchain/Fabric/1_部署 Fabric 生产网络.html" class="nav-link">
  Fabric
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front-end/Vue/Vue2.html" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/front-end/VuePress/VuePress项目部署.html" class="nav-link">
  VuePress
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/xBeTe" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/about.html" class="sidebar-link">关于</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/blockchain/" class="sidebar-heading clickable router-link-active open"><span>区块链</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>比特币</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>以太坊</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>Fabric</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blockchain/Fabric/1_部署 Fabric 生产网络.html" class="sidebar-link">搭建 Fabric 生产网络</a></li><li><a href="/blockchain/Fabric/2_部署 orderer 节点.html" class="sidebar-link">二进制安装部署 Orderer 节点</a></li><li><a href="/blockchain/Fabric/3_部署 peer 节点.html" class="sidebar-link">二进制安装部署 Peer 节点</a></li><li><a href="/blockchain/Fabric/4_Docker 方式多机部署生产网络.html" class="active sidebar-link">使用 Docker 部署生产网络</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blockchain/Fabric/4_Docker 方式多机部署生产网络.html#日志上限设置" class="sidebar-link">日志上限设置</a></li><li class="sidebar-sub-header"><a href="/blockchain/Fabric/4_Docker 方式多机部署生产网络.html#规划网络拓扑" class="sidebar-link">规划网络拓扑</a></li><li class="sidebar-sub-header"><a href="/blockchain/Fabric/4_Docker 方式多机部署生产网络.html#部署-orderer-节点" class="sidebar-link">部署 orderer 节点</a></li><li class="sidebar-sub-header"><a href="/blockchain/Fabric/4_Docker 方式多机部署生产网络.html#部署-org1-peer-节点" class="sidebar-link">部署 org1 peer 节点</a></li><li class="sidebar-sub-header"><a href="/blockchain/Fabric/4_Docker 方式多机部署生产网络.html#创建通道" class="sidebar-link">创建通道</a></li><li class="sidebar-sub-header"><a href="/blockchain/Fabric/4_Docker 方式多机部署生产网络.html#加入通道" class="sidebar-link">加入通道</a></li><li class="sidebar-sub-header"><a href="/blockchain/Fabric/4_Docker 方式多机部署生产网络.html#更新锚节点" class="sidebar-link">更新锚节点</a></li></ul></li><li><a href="/blockchain/Fabric/5_链码的安装与调用.html" class="sidebar-link">安装链码</a></li><li><a href="/blockchain/Fabric/6_部署 Hyperledger Explorer 超级账本浏览器.html" class="sidebar-link">部署超级账本浏览器</a></li><li><a href="/blockchain/Fabric/7_discover 工具的使用.html" class="sidebar-link">discover 工具的使用</a></li><li><a href="/blockchain/Fabric/8_Fabric Gateway 的使用.html" class="sidebar-link">Fabric Gateway 的使用</a></li><li><a href="/blockchain/Fabric/Fabric 数字版权应用.html" class="sidebar-link">Fabric 数字版权应用</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/front-end/" class="sidebar-heading clickable"><span>前端</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="使用-docker-部署生产网络"><a href="#使用-docker-部署生产网络" class="header-anchor">#</a> 使用 Docker 部署生产网络</h1> <h2 id="日志上限设置"><a href="#日志上限设置" class="header-anchor">#</a> 日志上限设置</h2> <p>在单机环境上部署生产网络，每个节点所在的容器每时每刻都在产生日志，短时间内很容易占用 10 G  + 的空间</p> <h3 id="docker-日志清理"><a href="#docker-日志清理" class="header-anchor">#</a> docker 日志清理</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">vim</span> docker-log-clear.sh
</code></pre></div><p>写入：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;======== start clean docker containers logs ========&quot;</span>
<span class="token assign-left variable">logs</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">find</span> /var/lib/docker/containers/ <span class="token parameter variable">-name</span> *-json.log<span class="token variable">)</span></span>
<span class="token keyword">for</span> <span class="token for-or-select variable">log</span> <span class="token keyword">in</span> <span class="token variable">$logs</span>
        <span class="token keyword">do</span>
                <span class="token builtin class-name">echo</span> <span class="token string">&quot;clean logs : <span class="token variable">$log</span>&quot;</span>
                <span class="token function">cat</span> /dev/null <span class="token operator">&gt;</span> <span class="token variable">$log</span>
        <span class="token keyword">done</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;======== end clean docker containers logs ========&quot;</span>
</code></pre></div><p>保存，退出</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 给脚本添加可执行权</span>
<span class="token function">chmod</span> +x docker-log-clear.sh

<span class="token comment"># 执行脚本</span>
docker-log-clear.sh
</code></pre></div><h3 id="容器单独日志上限"><a href="#容器单独日志上限" class="header-anchor">#</a> 容器单独日志上限</h3> <p>在 <code>docker-compose.yaml</code> 中可以设置每个容器的日志上限：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">nginx</span><span class="token punctuation">:</span> 
  <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>1.12.1 
  <span class="token key atrule">restart</span><span class="token punctuation">:</span> always 
  <span class="token key atrule">logging</span><span class="token punctuation">:</span> 
    <span class="token key atrule">driver</span><span class="token punctuation">:</span> “json<span class="token punctuation">-</span>file” 
    <span class="token key atrule">options</span><span class="token punctuation">:</span> 
      <span class="token key atrule">max-size</span><span class="token punctuation">:</span> “500m” 
</code></pre></div><h3 id="全局设置"><a href="#全局设置" class="header-anchor">#</a> 全局设置</h3> <p>新建/etc/docker/daemon.json，若有就不用新建了。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">vim</span> /etc/docker/daemon.json
</code></pre></div><p>添加log-dirver和log-opts参数，样例如下：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  ...<span class="token punctuation">,</span>
  <span class="token property">&quot;log-driver&quot;</span><span class="token operator">:</span><span class="token string">&quot;json-file&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;log-opts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">&quot;max-size&quot;</span><span class="token operator">:</span><span class="token string">&quot;500m&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;max-file&quot;</span><span class="token operator">:</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>max-size=500m</code>，意味着一个容器日志大小上限是500M，
<code>max-file=3</code>，意味着一个容器有三个日志，分别是id+.json、id+1.json、id+2.json。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 重启docker守护进程</span>

systemctl daemon-reload

systemctl restart <span class="token function">docker</span>
</code></pre></div><h2 id="规划网络拓扑"><a href="#规划网络拓扑" class="header-anchor">#</a> 规划网络拓扑</h2> <p>3 个 orderer 节点；组织 org1 , org1 下有两个 peer 节点， peer0 和 peer1; 组织 org2 , org2 下有两个 peer 节点， peer0 和 peer1;</p> <p><img src="http://mydoc-pics.oss-cn-chengdu.aliyuncs.com/img/up-38ef835b996d7793bb88ed5d61f2305d020.png" alt="img"></p> <table><thead><tr><th>节点</th> <th>宿主机 IP</th> <th>hosts</th> <th>端口</th></tr></thead> <tbody><tr><td>cli</td> <td>192.168.159.10</td> <td>N/A</td> <td>N/A</td></tr> <tr><td>orderer0</td> <td>192.168.159.10</td> <td>orderer0.example.com</td> <td>7050</td></tr> <tr><td>orderer1</td> <td>192.168.159.10</td> <td>orderer1.example.com</td> <td>8050</td></tr> <tr><td>orderer2</td> <td>192.168.159.10</td> <td>orderer2.example.com</td> <td>9050</td></tr></tbody></table> <table><thead><tr><th>节点</th> <th>宿主机 IP</th> <th>hosts</th> <th>端口</th></tr></thead> <tbody><tr><td>cli</td> <td>192.168.159.10</td> <td>N/A</td> <td>N/A</td></tr> <tr><td>org1-peer0</td> <td>192.168.159.10</td> <td>peer0.org1.example.com</td> <td>7051</td></tr> <tr><td>org1-peer1</td> <td>192.168.159.10</td> <td>peer1.org1.example.com</td> <td>8051</td></tr> <tr><td>org2-peer0</td> <td>192.168.159.10</td> <td>peer0.org2.example.com</td> <td>9051</td></tr> <tr><td>org2-peer1</td> <td>192.168.159.10</td> <td>peer1.org2.example.com</td> <td>10051</td></tr></tbody></table> <p>==注：在单机环境下模拟三个排序节点的部署，故每个节点需要区别端口号==</p> <p>根据 IP 与 host ，在系统 hosts 文件中新增</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">vim</span> /etc/hosts

<span class="token number">192.168</span>.159.10 orderer0.example.com
<span class="token number">192.168</span>.159.10 orderer1.example.com
<span class="token number">192.168</span>.159.10 orderer2.example.com

<span class="token comment"># 新增</span>
<span class="token number">192.168</span>.159.10 peer0.org1.example.com
<span class="token number">192.168</span>.159.10 peer1.org1.example.com

<span class="token number">192.168</span>.159.10 peer0.org2.example.com
<span class="token number">192.168</span>.159.10 peer1.org2.example.com
</code></pre></div><blockquote><p>注意：部署过程中使用的 order、peer、tools 等镜像版本为 2.4.1，使用 2.5.x 版本的镜像在加入通道时可能会出现位置错误</p></blockquote> <h2 id="部署-orderer-节点"><a href="#部署-orderer-节点" class="header-anchor">#</a> 部署 orderer 节点</h2> <p>使用 docker compose 部署 orderer 节点</p> <h3 id="编写-orderer-节点-docker-compose-文件"><a href="#编写-orderer-节点-docker-compose-文件" class="header-anchor">#</a> 编写 orderer 节点 docker-compose 文件</h3> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'2.0'</span>

<span class="token key atrule">services</span><span class="token punctuation">:</span>

    <span class="token key atrule">cli</span><span class="token punctuation">:</span>
        <span class="token key atrule">image</span><span class="token punctuation">:</span> hyperledger/fabric<span class="token punctuation">-</span>tools<span class="token punctuation">:</span>2.4.1
        <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
        <span class="token key atrule">container_name</span><span class="token punctuation">:</span> fabric<span class="token punctuation">-</span>cli
        <span class="token key atrule">hostname</span><span class="token punctuation">:</span> fabric<span class="token punctuation">-</span>cli
        <span class="token key atrule">tty</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">extra_hosts</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;orderer0.example.com:192.168.159.10&quot;</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;orderer1.example.com:192.168.159.10&quot;</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;orderer2.example.com:192.168.159.10&quot;</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;peer0.org1.example.com:192.168.159.10&quot;</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;peer1.org1.example.com:192.168.159.10&quot;</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;peer0.org2.example.com:192.168.159.10&quot;</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;peer1.org2.example.com:192.168.159.10&quot;</span>
        <span class="token key atrule">environment</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> CORE_PEER_ID=fabric<span class="token punctuation">-</span>cli
            <span class="token punctuation">-</span> CORE_PEER_ADDRESS=peer0.org1.example.com<span class="token punctuation">:</span><span class="token number">7051</span> <span class="token comment"># default to operate on peer0.org1</span>
            <span class="token punctuation">-</span> CORE_PEER_LOCALMSPID=Org1MSP
            <span class="token punctuation">-</span> CORE_PEER_TLS_CERT_FILE=/etc/hyperledger/fabric/crypto<span class="token punctuation">-</span>config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.crt
            <span class="token punctuation">-</span> CORE_PEER_TLS_KEY_FILE=/etc/hyperledger/fabric/crypto<span class="token punctuation">-</span>config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.key
            <span class="token punctuation">-</span> CORE_PEER_TLS_ROOTCERT_FILE=/etc/hyperledger/fabric/crypto<span class="token punctuation">-</span>config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt
            <span class="token punctuation">-</span> CORE_PEER_MSPCONFIGPATH=/etc/hyperledger/fabric/crypto<span class="token punctuation">-</span>config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp
            <span class="token punctuation">-</span> FABRIC_LOGGING_SPEC=DEBUG
            <span class="token punctuation">-</span> FABRIC_LOGGING_FORMAT=%<span class="token punctuation">{</span>color<span class="token punctuation">}</span><span class="token punctuation">[</span>%<span class="token punctuation">{</span>id<span class="token punctuation">:</span>03x<span class="token punctuation">}</span> %<span class="token punctuation">{</span>time<span class="token punctuation">:</span>01<span class="token punctuation">-</span>02 15<span class="token punctuation">:</span>04<span class="token punctuation">:</span>05.00 MST<span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>%<span class="token punctuation">{</span>module<span class="token punctuation">}</span><span class="token punctuation">]</span> %<span class="token punctuation">{</span>shortfunc<span class="token punctuation">}</span> <span class="token punctuation">-</span><span class="token punctuation">&gt;</span> %<span class="token punctuation">{</span>level<span class="token punctuation">:</span>.4s<span class="token punctuation">}</span>%<span class="token punctuation">{</span>color<span class="token punctuation">:</span>reset<span class="token punctuation">}</span> %<span class="token punctuation">{</span>message<span class="token punctuation">}</span>
            <span class="token punctuation">-</span> CORE_PEER_TLS_ENABLED=true  <span class="token comment"># to enable TLS, change to true</span>
            <span class="token punctuation">-</span> ORDERER_CA=/etc/hyperledger/fabric/crypto<span class="token punctuation">-</span>config/ordererOrganizations/example.com/orderers/orderer0.example.com/msp/tlscacerts/tlsca.example.com<span class="token punctuation">-</span>cert.pem
        <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> ../config/crypto<span class="token punctuation">-</span>config.yaml<span class="token punctuation">:</span>/etc/hyperledger/fabric/crypto<span class="token punctuation">-</span>config.yaml
            <span class="token punctuation">-</span> ../config/configtx.yaml<span class="token punctuation">:</span>/etc/hyperledger/fabric/configtx.yaml
            <span class="token punctuation">-</span> ../crypto<span class="token punctuation">-</span>config<span class="token punctuation">:</span>/etc/hyperledger/fabric/crypto<span class="token punctuation">-</span>config
            <span class="token punctuation">-</span> ../channel<span class="token punctuation">-</span>artifacts<span class="token punctuation">:</span>/tmp/channel<span class="token punctuation">-</span>artifacts
            <span class="token punctuation">-</span> ../chaincodes<span class="token punctuation">:</span>/etc/hyperledger/fabric/chaincodes
        <span class="token key atrule">working_dir</span><span class="token punctuation">:</span> /opt/gopath/src/github.com/hyperledger/fabric/peer
        <span class="token key atrule">command</span><span class="token punctuation">:</span> bash <span class="token punctuation">-</span>c 'cd /tmp; source scripts/func.sh; while true; do sleep 20170504; done'


    <span class="token key atrule">orderer0.example.com</span><span class="token punctuation">:</span>  <span class="token comment"># There can be multiple orderers</span>
        <span class="token key atrule">image</span><span class="token punctuation">:</span> hyperledger/fabric<span class="token punctuation">-</span>orderer<span class="token punctuation">:</span>2.4.1
        <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
        <span class="token key atrule">container_name</span><span class="token punctuation">:</span> orderer0.example.com
        <span class="token key atrule">hostname</span><span class="token punctuation">:</span> orderer0.example.com
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;7050:7050&quot;</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;8443:8443&quot;</span>
        <span class="token key atrule">extra_hosts</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;orderer0.example.com:192.168.159.10&quot;</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;orderer1.example.com:192.168.159.10&quot;</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;orderer2.example.com:192.168.159.10&quot;</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;peer0.org1.example.com:192.168.159.10&quot;</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;peer1.org1.example.com:192.168.159.10&quot;</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;peer0.org2.example.com:192.168.159.10&quot;</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;peer1.org2.example.com:192.168.159.10&quot;</span>
        <span class="token key atrule">environment</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> FABRIC_LOGGING_FORMAT=&quot;%<span class="token punctuation">{</span>color<span class="token punctuation">}</span>%<span class="token punctuation">{</span>time<span class="token punctuation">:</span>2006<span class="token punctuation">-</span>01<span class="token punctuation">-</span>02 15<span class="token punctuation">:</span>04<span class="token punctuation">:</span>05.000 MST<span class="token punctuation">}</span> <span class="token punctuation">[</span>%<span class="token punctuation">{</span>module<span class="token punctuation">}</span><span class="token punctuation">]</span> %<span class="token punctuation">{</span>shortfunc<span class="token punctuation">}</span> <span class="token punctuation">-</span><span class="token punctuation">&gt;</span> %<span class="token punctuation">{</span>level<span class="token punctuation">:</span>.4s<span class="token punctuation">}</span> %<span class="token punctuation">{</span>id<span class="token punctuation">:</span>03x<span class="token punctuation">}</span>%<span class="token punctuation">{</span>color<span class="token punctuation">:</span>reset<span class="token punctuation">}</span> %<span class="token punctuation">{</span>message<span class="token punctuation">}</span>&quot;
            <span class="token punctuation">-</span> ORDERER_GENERAL_LISTENADDRESS=0.0.0.0 <span class="token comment"># default: 127.0.0.1</span>
            <span class="token punctuation">-</span> ORDERER_GENERAL_LISTENPORT=7050
            <span class="token punctuation">-</span> ORDERER_GENERAL_GENESISMETHOD=file <span class="token comment"># default: provisional</span>
            <span class="token punctuation">-</span> ORDERER_GENERAL_BOOTSTRAPFILE=/etc/hyperledger/fabric/orderer.genesis.block <span class="token comment"># by default, all materials should be put under $FABRIC_CFG_PATH, which defaults to /etc/hyperledger/fabric</span>
            <span class="token punctuation">-</span> ORDERER_GENERAL_LOCALMSPID=OrdererMSP <span class="token comment"># default: DEFAULT</span>
            <span class="token punctuation">-</span> ORDERER_GENERAL_LOCALMSPDIR=/etc/hyperledger/fabric/msp
            <span class="token punctuation">-</span> ORDERER_GENERAL_LEDGERTYPE=file
            <span class="token comment">#- ORDERER_GENERAL_LEDGERTYPE=json  # default: file</span>
            <span class="token punctuation">-</span> ORDERER_OPERATIONS_LISTENADDRESS=0.0.0.0<span class="token punctuation">:</span><span class="token number">8443</span>  <span class="token comment"># operation RESTful API</span>
            <span class="token punctuation">-</span> ORDERER_METRICS_PROVIDER=prometheus  <span class="token comment"># prometheus will pull metrics from orderer via /metrics RESTful API</span>
            <span class="token comment">#- ORDERER_RAMLEDGER_HISTORY_SIZE=100  #only useful when use ram ledger</span>
            <span class="token comment"># enabled TLS</span>
            <span class="token punctuation">-</span> ORDERER_GENERAL_TLS_ENABLED=true <span class="token comment"># default: false</span>
            <span class="token punctuation">-</span> ORDERER_GENERAL_TLS_PRIVATEKEY=/etc/hyperledger/fabric/tls/server.key
            <span class="token punctuation">-</span> ORDERER_GENERAL_TLS_CERTIFICATE=/etc/hyperledger/fabric/tls/server.crt
            <span class="token punctuation">-</span> ORDERER_GENERAL_TLS_ROOTCAS=<span class="token punctuation">[</span>/etc/hyperledger/fabric/tls/ca.crt<span class="token punctuation">]</span>
            <span class="token comment"># Only required by raft mode</span>
            <span class="token punctuation">-</span> ORDERER_GENERAL_CLUSTER_CLIENTPRIVATEKEY=/etc/hyperledger/fabric/tls/server.key
            <span class="token punctuation">-</span> ORDERER_GENERAL_CLUSTER_CLIENTCERTIFICATE=/etc/hyperledger/fabric/tls/server.crt
            <span class="token punctuation">-</span> ORDERER_GENERAL_CLUSTER_ROOTCAS=<span class="token punctuation">[</span>/etc/hyperledger/fabric/tls/ca.crt<span class="token punctuation">]</span>
            <span class="token punctuation">-</span> FABRIC_LOGGING_SPEC=DEBUG
        <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> ../crypto<span class="token punctuation">-</span>config/ordererOrganizations/example.com/orderers/orderer0.example.com/msp<span class="token punctuation">:</span>/etc/hyperledger/fabric/msp
            <span class="token punctuation">-</span> ../crypto<span class="token punctuation">-</span>config/ordererOrganizations/example.com/orderers/orderer0.example.com/tls/<span class="token punctuation">:</span>/etc/hyperledger/fabric/tls
            <span class="token punctuation">-</span> ../channel<span class="token punctuation">-</span>artifacts/orderer.genesis.block<span class="token punctuation">:</span>/etc/hyperledger/fabric/orderer.genesis.block
<span class="token comment">#            - /var/hyperledger/production:/var/hyperledger/production</span>
        <span class="token key atrule">expose</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;7050&quot;</span>  <span class="token comment"># gRPC</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;8443&quot;</span>  <span class="token comment"># Operation REST</span>
        <span class="token key atrule">command</span><span class="token punctuation">:</span> orderer start

    <span class="token key atrule">orderer1.example.com</span><span class="token punctuation">:</span>
        <span class="token key atrule">image</span><span class="token punctuation">:</span> hyperledger/fabric<span class="token punctuation">-</span>orderer<span class="token punctuation">:</span>2.4.1
        <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
        <span class="token key atrule">container_name</span><span class="token punctuation">:</span> orderer1.example.com
        <span class="token key atrule">hostname</span><span class="token punctuation">:</span> orderer1.example.com
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;8050:7050&quot;</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;8444:8443&quot;</span>
        <span class="token key atrule">extra_hosts</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;orderer0.example.com:192.168.159.10&quot;</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;orderer1.example.com:192.168.159.10&quot;</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;orderer2.example.com:192.168.159.10&quot;</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;peer0.org1.example.com:192.168.159.10&quot;</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;peer1.org1.example.com:192.168.159.10&quot;</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;peer0.org2.example.com:192.168.159.10&quot;</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;peer1.org2.example.com:192.168.159.10&quot;</span>
        <span class="token key atrule">environment</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> FABRIC_LOGGING_SPEC=DEBUG
            <span class="token punctuation">-</span> FABRIC_LOGGING_FORMAT=&quot;%<span class="token punctuation">{</span>color<span class="token punctuation">}</span>%<span class="token punctuation">{</span>time<span class="token punctuation">:</span>2006<span class="token punctuation">-</span>01<span class="token punctuation">-</span>02 15<span class="token punctuation">:</span>04<span class="token punctuation">:</span>05.000 MST<span class="token punctuation">}</span> <span class="token punctuation">[</span>%<span class="token punctuation">{</span>module<span class="token punctuation">}</span><span class="token punctuation">]</span> %<span class="token punctuation">{</span>shortfunc<span class="token punctuation">}</span> <span class="token punctuation">-</span><span class="token punctuation">&gt;</span> %<span class="token punctuation">{</span>level<span class="token punctuation">:</span>.4s<span class="token punctuation">}</span> %<span class="token punctuation">{</span>id<span class="token punctuation">:</span>03x<span class="token punctuation">}</span>%<span class="token punctuation">{</span>color<span class="token punctuation">:</span>reset<span class="token punctuation">}</span> %<span class="token punctuation">{</span>message<span class="token punctuation">}</span>&quot;
            <span class="token punctuation">-</span> ORDERER_GENERAL_LISTENADDRESS=0.0.0.0 <span class="token comment"># default: 127.0.0.1</span>
            <span class="token punctuation">-</span> ORDERER_GENERAL_LISTENPORT=7050
            <span class="token punctuation">-</span> ORDERER_GENERAL_GENESISMETHOD=file <span class="token comment"># default: provisional</span>
            <span class="token punctuation">-</span> ORDERER_GENERAL_BOOTSTRAPFILE=/etc/hyperledger/fabric/orderer.genesis.block <span class="token comment"># by default, all materials should be put under $FABRIC_CFG_PATH, which defaults to /etc/hyperledger/fabric</span>
            <span class="token punctuation">-</span> ORDERER_GENERAL_LOCALMSPID=OrdererMSP <span class="token comment"># default: DEFAULT</span>
            <span class="token punctuation">-</span> ORDERER_GENERAL_LOCALMSPDIR=/etc/hyperledger/fabric/msp
            <span class="token punctuation">-</span> ORDERER_GENERAL_LEDGERTYPE=file
            <span class="token comment">#- ORDERER_GENERAL_LEDGERTYPE=json  # default: file</span>
            <span class="token punctuation">-</span> ORDERER_OPERATIONS_LISTENADDRESS=0.0.0.0<span class="token punctuation">:</span><span class="token number">8443</span>  <span class="token comment"># operation RESTful API</span>
            <span class="token punctuation">-</span> ORDERER_METRICS_PROVIDER=prometheus  <span class="token comment"># prometheus will pull metrics from orderer via /metrics RESTful API</span>
            <span class="token comment">#- ORDERER_RAMLEDGER_HISTORY_SIZE=100  #only useful when use ram ledger</span>
            <span class="token comment"># enabled TLS</span>
            <span class="token punctuation">-</span> ORDERER_GENERAL_TLS_ENABLED=true <span class="token comment"># default: false</span>
            <span class="token punctuation">-</span> ORDERER_GENERAL_TLS_PRIVATEKEY=/etc/hyperledger/fabric/tls/server.key
            <span class="token punctuation">-</span> ORDERER_GENERAL_TLS_CERTIFICATE=/etc/hyperledger/fabric/tls/server.crt
            <span class="token punctuation">-</span> ORDERER_GENERAL_TLS_ROOTCAS=<span class="token punctuation">[</span>/etc/hyperledger/fabric/tls/ca.crt<span class="token punctuation">]</span>
            <span class="token comment"># Only required by raft mode</span>
            <span class="token punctuation">-</span> ORDERER_GENERAL_CLUSTER_CLIENTPRIVATEKEY=/etc/hyperledger/fabric/tls/server.key
            <span class="token punctuation">-</span> ORDERER_GENERAL_CLUSTER_CLIENTCERTIFICATE=/etc/hyperledger/fabric/tls/server.crt
            <span class="token punctuation">-</span> ORDERER_GENERAL_CLUSTER_ROOTCAS=<span class="token punctuation">[</span>/etc/hyperledger/fabric/tls/ca.crt<span class="token punctuation">]</span>
            <span class="token punctuation">-</span> ORDERER_GENERAL_CLUSTER_SENDBUFFERSIZE=10
        <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> ../crypto<span class="token punctuation">-</span>config/ordererOrganizations/example.com/orderers/orderer1.example.com/msp<span class="token punctuation">:</span>/etc/hyperledger/fabric/msp
            <span class="token punctuation">-</span> ../crypto<span class="token punctuation">-</span>config/ordererOrganizations/example.com/orderers/orderer1.example.com/tls/<span class="token punctuation">:</span>/etc/hyperledger/fabric/tls
            <span class="token punctuation">-</span> ../channel<span class="token punctuation">-</span>artifacts/orderer.genesis.block<span class="token punctuation">:</span>/etc/hyperledger/fabric/orderer.genesis.block
<span class="token comment">#            - /var/hyperledger/production:/var/hyperledger/production</span>
        <span class="token key atrule">command</span><span class="token punctuation">:</span> orderer start    


    <span class="token key atrule">orderer2.example.com</span><span class="token punctuation">:</span>
        <span class="token key atrule">image</span><span class="token punctuation">:</span> hyperledger/fabric<span class="token punctuation">-</span>orderer<span class="token punctuation">:</span>2.4.1
        <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
        <span class="token key atrule">container_name</span><span class="token punctuation">:</span> orderer2.example.com
        <span class="token key atrule">hostname</span><span class="token punctuation">:</span> orderer2.example.com
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;9050:7050&quot;</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;8445:8443&quot;</span>
        <span class="token key atrule">extra_hosts</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;orderer0.example.com:192.168.159.10&quot;</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;orderer1.example.com:192.168.159.10&quot;</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;orderer2.example.com:192.168.159.10&quot;</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;peer0.org1.example.com:192.168.159.10&quot;</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;peer1.org1.example.com:192.168.159.10&quot;</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;peer0.org2.example.com:192.168.159.10&quot;</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;peer1.org2.example.com:192.168.159.10&quot;</span>
        <span class="token key atrule">environment</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> FABRIC_LOGGING_SPEC=DEBUG  <span class="token comment"># default: INFO</span>
            <span class="token punctuation">-</span> FABRIC_LOGGING_FORMAT=&quot;%<span class="token punctuation">{</span>color<span class="token punctuation">}</span>%<span class="token punctuation">{</span>time<span class="token punctuation">:</span>2006<span class="token punctuation">-</span>01<span class="token punctuation">-</span>02 15<span class="token punctuation">:</span>04<span class="token punctuation">:</span>05.000 MST<span class="token punctuation">}</span> <span class="token punctuation">[</span>%<span class="token punctuation">{</span>module<span class="token punctuation">}</span><span class="token punctuation">]</span> %<span class="token punctuation">{</span>shortfunc<span class="token punctuation">}</span> <span class="token punctuation">-</span><span class="token punctuation">&gt;</span> %<span class="token punctuation">{</span>level<span class="token punctuation">:</span>.4s<span class="token punctuation">}</span> %<span class="token punctuation">{</span>id<span class="token punctuation">:</span>03x<span class="token punctuation">}</span>%<span class="token punctuation">{</span>color<span class="token punctuation">:</span>reset<span class="token punctuation">}</span> %<span class="token punctuation">{</span>message<span class="token punctuation">}</span>&quot;
            <span class="token punctuation">-</span> ORDERER_GENERAL_LISTENADDRESS=0.0.0.0 <span class="token comment"># default: 127.0.0.1</span>
            <span class="token punctuation">-</span> ORDERER_GENERAL_LISTENPORT=7050
            <span class="token punctuation">-</span> ORDERER_GENERAL_GENESISMETHOD=file <span class="token comment"># default: provisional</span>
            <span class="token punctuation">-</span> ORDERER_GENERAL_BOOTSTRAPFILE=/etc/hyperledger/fabric/orderer.genesis.block <span class="token comment"># by default, all materials should be put under $FABRIC_CFG_PATH, which defaults to /etc/hyperledger/fabric</span>
            <span class="token punctuation">-</span> ORDERER_GENERAL_LOCALMSPID=OrdererMSP <span class="token comment"># default: DEFAULT</span>
            <span class="token punctuation">-</span> ORDERER_GENERAL_LOCALMSPDIR=/etc/hyperledger/fabric/msp
            <span class="token punctuation">-</span> ORDERER_GENERAL_LEDGERTYPE=file
            <span class="token comment">#- ORDERER_GENERAL_LEDGERTYPE=json  # default: file</span>
            <span class="token punctuation">-</span> ORDERER_OPERATIONS_LISTENADDRESS=0.0.0.0<span class="token punctuation">:</span><span class="token number">8443</span>  <span class="token comment"># operation RESTful API</span>
            <span class="token punctuation">-</span> ORDERER_METRICS_PROVIDER=prometheus  <span class="token comment"># prometheus will pull metrics from orderer via /metrics RESTful API</span>
            <span class="token comment">#- ORDERER_RAMLEDGER_HISTORY_SIZE=100  #only useful when use ram ledger</span>
            <span class="token comment"># enabled TLS</span>
            <span class="token punctuation">-</span> ORDERER_GENERAL_TLS_ENABLED=true <span class="token comment"># default: false</span>
            <span class="token punctuation">-</span> ORDERER_GENERAL_TLS_PRIVATEKEY=/etc/hyperledger/fabric/tls/server.key
            <span class="token punctuation">-</span> ORDERER_GENERAL_TLS_CERTIFICATE=/etc/hyperledger/fabric/tls/server.crt
            <span class="token punctuation">-</span> ORDERER_GENERAL_TLS_ROOTCAS=<span class="token punctuation">[</span>/etc/hyperledger/fabric/tls/ca.crt<span class="token punctuation">]</span>
            <span class="token comment"># Only required by raft mode</span>
            <span class="token punctuation">-</span> ORDERER_GENERAL_CLUSTER_CLIENTPRIVATEKEY=/etc/hyperledger/fabric/tls/server.key
            <span class="token punctuation">-</span> ORDERER_GENERAL_CLUSTER_CLIENTCERTIFICATE=/etc/hyperledger/fabric/tls/server.crt
            <span class="token punctuation">-</span> ORDERER_GENERAL_CLUSTER_ROOTCAS=<span class="token punctuation">[</span>/etc/hyperledger/fabric/tls/ca.crt<span class="token punctuation">]</span>
            <span class="token punctuation">-</span> ORDERER_GENERAL_CLUSTER_SENDBUFFERSIZE=10
        <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> ../crypto<span class="token punctuation">-</span>config/ordererOrganizations/example.com/orderers/orderer2.example.com/msp<span class="token punctuation">:</span>/etc/hyperledger/fabric/msp
            <span class="token punctuation">-</span> ../crypto<span class="token punctuation">-</span>config/ordererOrganizations/example.com/orderers/orderer2.example.com/tls/<span class="token punctuation">:</span>/etc/hyperledger/fabric/tls
            <span class="token punctuation">-</span> ../channel<span class="token punctuation">-</span>artifacts/orderer.genesis.block<span class="token punctuation">:</span>/etc/hyperledger/fabric/orderer.genesis.block
<span class="token comment">#            - /var/hyperledger/production:/var/hyperledger/production</span>
        <span class="token key atrule">command</span><span class="token punctuation">:</span> orderer start
</code></pre></div><blockquote><p>注：</p> <ul><li>在单机环境下部署，不同节点之间内部端口可以相同，但需要区分容器在宿主机中映射的端口</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">orderer0.example.com</span><span class="token punctuation">:</span>
	<span class="token punctuation">...</span>
	<span class="token key atrule">ports</span><span class="token punctuation">:</span> 
        <span class="token punctuation">-</span> <span class="token string">&quot;7050:7050&quot;</span>
        <span class="token punctuation">-</span> <span class="token string">&quot;8443:8443&quot;</span>
     <span class="token punctuation">...</span>
<span class="token key atrule">orderer1.example.com</span><span class="token punctuation">:</span>
    <span class="token punctuation">...</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token string">&quot;8050:7050&quot;</span>
        <span class="token punctuation">-</span> <span class="token string">&quot;8444:8443&quot;</span>
    <span class="token punctuation">...</span>        
<span class="token key atrule">orderer2.example.com</span><span class="token punctuation">:</span>
	<span class="token punctuation">...</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token string">&quot;9050:7050&quot;</span>
        <span class="token punctuation">-</span> <span class="token string">&quot;8445:8443&quot;</span>
    <span class="token punctuation">...</span>
    
</code></pre></div><ul><li>修改 <code>volumes</code> 中映射的宿主机目录为正确目录</li></ul></blockquote> <p>启动 orderer 节点：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">docker-compose</span> <span class="token parameter variable">-f</span> docker-compose-3orderer.yaml up <span class="token parameter variable">-d</span>
</code></pre></div><p>如果想停止并且删除服务：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">docker-compose</span> <span class="token parameter variable">-f</span> docker-compose-3orderer.yaml down
</code></pre></div><h2 id="部署-org1-peer-节点"><a href="#部署-org1-peer-节点" class="header-anchor">#</a> 部署 org1 peer 节点</h2> <h3 id="编写-docker-compose-文件"><a href="#编写-docker-compose-文件" class="header-anchor">#</a> 编写 docker-compose 文件</h3> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'2.0'</span>

<span class="token key atrule">services</span><span class="token punctuation">:</span>

    <span class="token key atrule">peer0.org2.example.com</span><span class="token punctuation">:</span>
        <span class="token key atrule">image</span><span class="token punctuation">:</span> hyperledger/fabric<span class="token punctuation">-</span>peer<span class="token punctuation">:</span>2.4.1
        <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
        <span class="token key atrule">container_name</span><span class="token punctuation">:</span> peer0.org2.example.com
        <span class="token key atrule">hostname</span><span class="token punctuation">:</span> peer0.org2.example.com
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> 9051<span class="token punctuation">:</span><span class="token number">7051</span>
            <span class="token punctuation">-</span> 9052<span class="token punctuation">:</span><span class="token number">7052</span>
            <span class="token punctuation">-</span> 9445<span class="token punctuation">:</span><span class="token number">9443</span>	
        <span class="token key atrule">extra_hosts</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;orderer0.example.com:192.168.159.10&quot;</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;orderer1.example.com:192.168.159.10&quot;</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;orderer2.example.com:192.168.159.10&quot;</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;peer0.org1.example.com:192.168.159.10&quot;</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;peer1.org1.example.com:192.168.159.10&quot;</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;peer0.org2.example.com:192.168.159.10&quot;</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;peer1.org2.example.com:192.168.159.10&quot;</span>
        <span class="token key atrule">environment</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> FABRIC_LOGGING_SPEC=INFO
            <span class="token punctuation">-</span> FABRIC_LOGGING_FORMAT=&quot;%<span class="token punctuation">{</span>color<span class="token punctuation">}</span>%<span class="token punctuation">{</span>time<span class="token punctuation">:</span>2006<span class="token punctuation">-</span>01<span class="token punctuation">-</span>02 15<span class="token punctuation">:</span>04<span class="token punctuation">:</span>05.000 MST<span class="token punctuation">}</span> <span class="token punctuation">[</span>%<span class="token punctuation">{</span>module<span class="token punctuation">}</span><span class="token punctuation">]</span> %<span class="token punctuation">{</span>shortfunc<span class="token punctuation">}</span> <span class="token punctuation">-</span><span class="token punctuation">&gt;</span> %<span class="token punctuation">{</span>level<span class="token punctuation">:</span>.4s<span class="token punctuation">}</span> %<span class="token punctuation">{</span>id<span class="token punctuation">:</span>03x<span class="token punctuation">}</span>%<span class="token punctuation">{</span>color<span class="token punctuation">:</span>reset<span class="token punctuation">}</span> %<span class="token punctuation">{</span>message<span class="token punctuation">}</span>&quot;
            <span class="token punctuation">-</span> CORE_PEER_ADDRESSAUTODETECT=false
            <span class="token punctuation">-</span> CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=host  <span class="token comment"># uncomment this to use specific network</span>
            <span class="token punctuation">-</span> CORE_PEER_GOSSIP_USELEADERELECTION=true
            <span class="token punctuation">-</span> CORE_PEER_GOSSIP_ORGLEADER=false  <span class="token comment"># whether this node is the org leader, default to false</span>
            <span class="token punctuation">-</span> CORE_OPERATIONS_LISTENADDRESS=0.0.0.0<span class="token punctuation">:</span><span class="token number">9443</span>  <span class="token comment"># operation RESTful API</span>
            <span class="token punctuation">-</span> CORE_METRICS_PROVIDER=prometheus  <span class="token comment"># prometheus will pull metrics from fabric via /metrics RESTful API</span>
            <span class="token punctuation">-</span> CORE_PEER_PROFILE_ENABLED=false
            <span class="token punctuation">-</span> CORE_PEER_TLS_ENABLED=true
            <span class="token punctuation">-</span> CORE_PEER_TLS_CERT_FILE=/etc/hyperledger/fabric/tls/server.crt
            <span class="token punctuation">-</span> CORE_PEER_TLS_KEY_FILE=/etc/hyperledger/fabric/tls/server.key
            <span class="token punctuation">-</span> CORE_PEER_TLS_ROOTCERT_FILE=/etc/hyperledger/fabric/tls/ca.crt
            <span class="token punctuation">-</span> CORE_CHAINCODE_BUILDER=hyperledger/fabric<span class="token punctuation">-</span>ccenv<span class="token punctuation">:</span>2.4.1
            <span class="token punctuation">-</span> CORE_CHAINCODE_GOLANG_RUNTIME=hyperledger/fabric<span class="token punctuation">-</span>baseos<span class="token punctuation">:</span>2.4.1
            <span class="token punctuation">-</span> CORE_CHAINCODE_JAVA_RUNTIME=hyperledger/fabric<span class="token punctuation">-</span>javaenv<span class="token punctuation">:</span>2.4.1
            <span class="token punctuation">-</span> CORE_CHAINCODE_NODE_RUNTIME=hyperledger/fabric<span class="token punctuation">-</span>nodeenv<span class="token punctuation">:</span>2.4.1
            <span class="token punctuation">-</span> CORE_PEER_ID=peer0.org2.example.com
            <span class="token punctuation">-</span> CORE_PEER_ADDRESS=peer0.org2.example.com<span class="token punctuation">:</span><span class="token number">9051</span>
            <span class="token punctuation">-</span> CORE_PEER_CHAINCODELISTENADDRESS=0.0.0.0<span class="token punctuation">:</span><span class="token number">7052</span>
            <span class="token punctuation">-</span> CORE_PEER_CHAINCODEADDRESS=peer0.org2.example.com<span class="token punctuation">:</span><span class="token number">9052</span>
            <span class="token punctuation">-</span> CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.org2.example.com<span class="token punctuation">:</span><span class="token number">9051</span>
            <span class="token punctuation">-</span> CORE_PEER_GOSSIP_BOOTSTRAP=peer0.org2.example.com<span class="token punctuation">:</span><span class="token number">9051</span>
            <span class="token punctuation">-</span> CORE_PEER_LOCALMSPID=Org2MSP
            <span class="token punctuation">-</span> FABRIC_LOGGING_SPEC=DEBUG <span class="token comment"># info:core.chaincode=debug</span>
            <span class="token punctuation">-</span> CORE_LEDGER_STATE_STATEDATABASE=CouchDB
            <span class="token punctuation">-</span> CORE_LEDGER_STATE_COUCHDBCONFIG_COUCHDBADDRESS=peer0.org2.couchdb<span class="token punctuation">:</span><span class="token number">5984</span>
            <span class="token punctuation">-</span> CORE_LEDGER_STATE_COUCHDBCONFIG_USERNAME=admin
            <span class="token punctuation">-</span> CORE_LEDGER_STATE_COUCHDBCONFIG_PASSWORD=adminpw
        <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> /var/run/docker.sock<span class="token punctuation">:</span>/var/run/docker.sock
            <span class="token punctuation">-</span> ../crypto<span class="token punctuation">-</span>config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/msp<span class="token punctuation">:</span>/etc/hyperledger/fabric/msp
            <span class="token punctuation">-</span> ../crypto<span class="token punctuation">-</span>config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls<span class="token punctuation">:</span>/etc/hyperledger/fabric/tls
<span class="token comment">#            - /var/hyperledger/production:/var/hyperledger/production</span>
        <span class="token key atrule">expose</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;9051&quot;</span>  <span class="token comment"># gRPC</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;9445&quot;</span>  <span class="token comment"># Operation REST</span>
        <span class="token comment">#command: bash -c 'bash /tmp/peer_build.sh; peer node start'</span>
        <span class="token key atrule">command</span><span class="token punctuation">:</span> peer node start
        <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> peer0.org2.couchdb


    <span class="token key atrule">peer1.org2.example.com</span><span class="token punctuation">:</span>
        <span class="token key atrule">image</span><span class="token punctuation">:</span> hyperledger/fabric<span class="token punctuation">-</span>peer<span class="token punctuation">:</span>2.4.1
        <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
        <span class="token key atrule">container_name</span><span class="token punctuation">:</span> peer1.org2.example.com
        <span class="token key atrule">hostname</span><span class="token punctuation">:</span> peer1.org2.example.com
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> 10051<span class="token punctuation">:</span><span class="token number">7051</span>
            <span class="token punctuation">-</span> 10052<span class="token punctuation">:</span><span class="token number">7052</span>
            <span class="token punctuation">-</span> 9446<span class="token punctuation">:</span><span class="token number">9443</span>
        <span class="token key atrule">extra_hosts</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;orderer0.example.com:192.168.159.10&quot;</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;orderer1.example.com:192.168.159.10&quot;</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;orderer2.example.com:192.168.159.10&quot;</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;peer0.org1.example.com:192.168.159.10&quot;</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;peer1.org1.example.com:192.168.159.10&quot;</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;peer0.org2.example.com:192.168.159.10&quot;</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;peer1.org2.example.com:192.168.159.10&quot;</span>
        <span class="token key atrule">environment</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> FABRIC_LOGGING_SPEC=INFO
            <span class="token punctuation">-</span> FABRIC_LOGGING_FORMAT=&quot;%<span class="token punctuation">{</span>color<span class="token punctuation">}</span>%<span class="token punctuation">{</span>time<span class="token punctuation">:</span>2006<span class="token punctuation">-</span>01<span class="token punctuation">-</span>02 15<span class="token punctuation">:</span>04<span class="token punctuation">:</span>05.000 MST<span class="token punctuation">}</span> <span class="token punctuation">[</span>%<span class="token punctuation">{</span>module<span class="token punctuation">}</span><span class="token punctuation">]</span> %<span class="token punctuation">{</span>shortfunc<span class="token punctuation">}</span> <span class="token punctuation">-</span><span class="token punctuation">&gt;</span> %<span class="token punctuation">{</span>level<span class="token punctuation">:</span>.4s<span class="token punctuation">}</span> %<span class="token punctuation">{</span>id<span class="token punctuation">:</span>03x<span class="token punctuation">}</span>%<span class="token punctuation">{</span>color<span class="token punctuation">:</span>reset<span class="token punctuation">}</span> %<span class="token punctuation">{</span>message<span class="token punctuation">}</span>&quot;
            <span class="token punctuation">-</span> CORE_PEER_ADDRESSAUTODETECT=false
            <span class="token punctuation">-</span> CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=host  <span class="token comment"># uncomment this to use specific network</span>
            <span class="token punctuation">-</span> CORE_PEER_GOSSIP_USELEADERELECTION=true
            <span class="token punctuation">-</span> CORE_PEER_GOSSIP_ORGLEADER=false  <span class="token comment"># whether this node is the org leader, default to false</span>
            <span class="token punctuation">-</span> CORE_OPERATIONS_LISTENADDRESS=0.0.0.0<span class="token punctuation">:</span><span class="token number">9443</span>  <span class="token comment"># operation RESTful API</span>
            <span class="token punctuation">-</span> CORE_METRICS_PROVIDER=prometheus  <span class="token comment"># prometheus will pull metrics from fabric via /metrics RESTful API</span>
            <span class="token punctuation">-</span> CORE_PEER_PROFILE_ENABLED=false
            <span class="token punctuation">-</span> CORE_PEER_TLS_ENABLED=true
            <span class="token punctuation">-</span> CORE_PEER_TLS_CERT_FILE=/etc/hyperledger/fabric/tls/server.crt
            <span class="token punctuation">-</span> CORE_PEER_TLS_KEY_FILE=/etc/hyperledger/fabric/tls/server.key
            <span class="token punctuation">-</span> CORE_PEER_TLS_ROOTCERT_FILE=/etc/hyperledger/fabric/tls/ca.crt
            <span class="token punctuation">-</span> CORE_CHAINCODE_BUILDER=hyperledger/fabric<span class="token punctuation">-</span>ccenv<span class="token punctuation">:</span>2.4.1
            <span class="token punctuation">-</span> CORE_CHAINCODE_GOLANG_RUNTIME=hyperledger/fabric<span class="token punctuation">-</span>baseos<span class="token punctuation">:</span>2.4.1
            <span class="token punctuation">-</span> CORE_CHAINCODE_JAVA_RUNTIME=hyperledger/fabric<span class="token punctuation">-</span>javaenv<span class="token punctuation">:</span>2.4.1
            <span class="token punctuation">-</span> CORE_CHAINCODE_NODE_RUNTIME=hyperledger/fabric<span class="token punctuation">-</span>nodeenv<span class="token punctuation">:</span>2.4.1
            <span class="token punctuation">-</span> CORE_PEER_ID=peer1.org2.example.com
            <span class="token punctuation">-</span> CORE_PEER_ADDRESS=peer1.org2.example.com<span class="token punctuation">:</span><span class="token number">10051</span>
            <span class="token punctuation">-</span> CORE_PEER_CHAINCODELISTENADDRESS=0.0.0.0<span class="token punctuation">:</span><span class="token number">7052</span>
            <span class="token punctuation">-</span> CORE_PEER_CHAINCODEADDRESS=peer1.org2.example.com<span class="token punctuation">:</span><span class="token number">10052</span>
            <span class="token punctuation">-</span> CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer1.org2.example.com<span class="token punctuation">:</span><span class="token number">10051</span>
            <span class="token punctuation">-</span> CORE_PEER_GOSSIP_BOOTSTRAP=peer1.org2.example.com<span class="token punctuation">:</span><span class="token number">10051</span>
            <span class="token punctuation">-</span> CORE_PEER_LOCALMSPID=Org2MSP
            <span class="token punctuation">-</span> FABRIC_LOGGING_SPEC=DEBUG <span class="token comment"># info:core.chaincode=debug</span>
            <span class="token punctuation">-</span> CORE_LEDGER_STATE_STATEDATABASE=CouchDB
            <span class="token punctuation">-</span> CORE_LEDGER_STATE_COUCHDBCONFIG_COUCHDBADDRESS=peer1.org2.couchdb<span class="token punctuation">:</span><span class="token number">5984</span>
            <span class="token punctuation">-</span> CORE_LEDGER_STATE_COUCHDBCONFIG_USERNAME=admin
            <span class="token punctuation">-</span> CORE_LEDGER_STATE_COUCHDBCONFIG_PASSWORD=adminpw
        <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> /var/run/docker.sock<span class="token punctuation">:</span>/var/run/docker.sock
            <span class="token punctuation">-</span> ../crypto<span class="token punctuation">-</span>config/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/msp<span class="token punctuation">:</span>/etc/hyperledger/fabric/msp
            <span class="token punctuation">-</span> ../crypto<span class="token punctuation">-</span>config/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/tls<span class="token punctuation">:</span>/etc/hyperledger/fabric/tls
<span class="token comment">#            - /var/hyperledger/production:/var/hyperledger/production</span>
        <span class="token key atrule">expose</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;10051&quot;</span>  <span class="token comment"># gRPC</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;9446&quot;</span>  <span class="token comment"># Operation REST</span>
        <span class="token comment">#command: bash -c 'bash /tmp/peer_build.sh; peer node start'</span>
        <span class="token key atrule">command</span><span class="token punctuation">:</span> peer node start
        <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> peer1.org2.couchdb


    <span class="token key atrule">peer0.org2.couchdb</span><span class="token punctuation">:</span>
        <span class="token key atrule">image</span><span class="token punctuation">:</span> couchdb<span class="token punctuation">:</span>3.1.1
        <span class="token key atrule">container_name</span><span class="token punctuation">:</span> peer0.org2.couchdb
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> 7984<span class="token punctuation">:</span><span class="token number">5984</span>  <span class="token comment"># this is the restful API addr, can also access fauxton web ui thru http://localhost:5984/_utils/</span>
        <span class="token key atrule">environment</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> COUCHDB_USER=admin
            <span class="token punctuation">-</span> COUCHDB_PASSWORD=adminpw

    <span class="token key atrule">peer1.org2.couchdb</span><span class="token punctuation">:</span>
        <span class="token key atrule">image</span><span class="token punctuation">:</span> couchdb<span class="token punctuation">:</span>3.1.1
        <span class="token key atrule">container_name</span><span class="token punctuation">:</span> peer1.org2.couchdb
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> 8984<span class="token punctuation">:</span><span class="token number">5984</span>  <span class="token comment"># this is the restful API addr, can also access fauxton web ui thru http://localhost:5984/_utils/</span>
        <span class="token key atrule">environment</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> COUCHDB_USER=admin
            <span class="token punctuation">-</span> COUCHDB_PASSWORD=adminpw
</code></pre></div><p>启动 org2 peer 节点：</p> <div class="language- extra-class"><pre class="language-text"><code>docker-compose -f docker-compose-org2-2peer.yaml up -d
</code></pre></div><h2 id="创建通道"><a href="#创建通道" class="header-anchor">#</a> 创建通道</h2> <p>进入 cli 容器：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> fabric-cli <span class="token function">bash</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">APP_CHANNEL</span><span class="token operator">=</span>businesschannel
<span class="token builtin class-name">export</span> <span class="token assign-left variable">TIMEOUT</span><span class="token operator">=</span><span class="token number">30</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CORE_PEER_LOCALMSPID</span><span class="token operator">=</span>Org1MSP
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CORE_PEER_MSPCONFIGPATH</span><span class="token operator">=</span>/etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp

peer channel create <span class="token parameter variable">-o</span> orderer0.example.com:7050 <span class="token parameter variable">-c</span> <span class="token variable">${APP_CHANNEL}</span> <span class="token parameter variable">-f</span> <span class="token string">&quot;/tmp/channel-artifacts/<span class="token variable">$APP_CHANNEL</span>.tx&quot;</span> <span class="token parameter variable">--timeout</span> <span class="token string">&quot;<span class="token variable">${TIMEOUT}</span>s&quot;</span> <span class="token parameter variable">--tls</span> <span class="token parameter variable">--cafile</span> /etc/hyperledger/fabric/crypto-config/ordererOrganizations/example.com/orderers/orderer0.example.com/msp/tlscacerts/tlsca.example.com-cert.pem
</code></pre></div><p>创建成功后会在当前路径下生成 <code>businesschannel.block</code> 文件。</p> <div class="language- extra-class"><pre class="language-text"><code>mv businesschannel.block /tmp/channel-artifacts/
</code></pre></div><h2 id="加入通道"><a href="#加入通道" class="header-anchor">#</a> 加入通道</h2> <p>进入 cli 容器：</p> <div class="language- extra-class"><pre class="language-text"><code>docker exec -it fabric-cli bash
</code></pre></div><p>org1-peer0 加入通道：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">CORE_PEER_TLS_ENABLED</span><span class="token operator">=</span>true
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CORE_PEER_LOCALMSPID</span><span class="token operator">=</span><span class="token string">&quot;Org1MSP&quot;</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CORE_PEER_TLS_ROOTCERT_FILE</span><span class="token operator">=</span>/etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CORE_PEER_MSPCONFIGPATH</span><span class="token operator">=</span>/etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CORE_PEER_ADDRESS</span><span class="token operator">=</span>peer0.org1.example.com:7051

peer channel <span class="token function">join</span> <span class="token parameter variable">-b</span> /tmp/channel-artifacts/businesschannel.block
</code></pre></div><p>结果如下：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">[</span>020 02-18 03:57:28.30 UTC<span class="token punctuation">]</span> <span class="token punctuation">[</span>channelCmd<span class="token punctuation">]</span> executeJoin -<span class="token operator">&gt;</span> INFO Successfully submitted proposal to <span class="token function">join</span> channel
</code></pre></div><p>org1-peer1 加入通道：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">CORE_PEER_TLS_ENABLED</span><span class="token operator">=</span>true
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CORE_PEER_LOCALMSPID</span><span class="token operator">=</span><span class="token string">&quot;Org1MSP&quot;</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CORE_PEER_TLS_ROOTCERT_FILE</span><span class="token operator">=</span>/etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/tls/ca.crt
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CORE_PEER_MSPCONFIGPATH</span><span class="token operator">=</span>/etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CORE_PEER_ADDRESS</span><span class="token operator">=</span>peer1.org1.example.com:8051

peer channel <span class="token function">join</span> <span class="token parameter variable">-b</span> /tmp/channel-artifacts/businesschannel.block
</code></pre></div><p>org2-peer0 加入通道：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">CORE_PEER_TLS_ENABLED</span><span class="token operator">=</span>true
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CORE_PEER_LOCALMSPID</span><span class="token operator">=</span><span class="token string">&quot;Org2MSP&quot;</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CORE_PEER_TLS_ROOTCERT_FILE</span><span class="token operator">=</span>/etc/hyperledger/fabric/crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CORE_PEER_MSPCONFIGPATH</span><span class="token operator">=</span>/etc/hyperledger/fabric/crypto-config/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CORE_PEER_ADDRESS</span><span class="token operator">=</span>peer0.org2.example.com:9051

peer channel <span class="token function">join</span> <span class="token parameter variable">-b</span> /tmp/channel-artifacts/businesschannel.block
</code></pre></div><p>org2-peer1 加入通道：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">CORE_PEER_TLS_ENABLED</span><span class="token operator">=</span>true
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CORE_PEER_LOCALMSPID</span><span class="token operator">=</span><span class="token string">&quot;Org2MSP&quot;</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CORE_PEER_TLS_ROOTCERT_FILE</span><span class="token operator">=</span>/etc/hyperledger/fabric/crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CORE_PEER_MSPCONFIGPATH</span><span class="token operator">=</span>/etc/hyperledger/fabric/crypto-config/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CORE_PEER_ADDRESS</span><span class="token operator">=</span>peer1.org2.example.com:10051

peer channel <span class="token function">join</span> <span class="token parameter variable">-b</span> /tmp/channel-artifacts/businesschannel.block
</code></pre></div><h2 id="更新锚节点"><a href="#更新锚节点" class="header-anchor">#</a> 更新锚节点</h2> <p>org1 更新锚节点：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">CORE_PEER_TLS_ENABLED</span><span class="token operator">=</span>true
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CORE_PEER_LOCALMSPID</span><span class="token operator">=</span><span class="token string">&quot;Org1MSP&quot;</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CORE_PEER_TLS_ROOTCERT_FILE</span><span class="token operator">=</span>/etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CORE_PEER_MSPCONFIGPATH</span><span class="token operator">=</span>/etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CORE_PEER_ADDRESS</span><span class="token operator">=</span>peer0.org1.example.com:7051

peer channel update <span class="token parameter variable">-o</span> orderer0.example.com:7050 <span class="token parameter variable">-c</span> businesschannel <span class="token parameter variable">-f</span> /tmp/channel-artifacts/Org1MSPanchors.tx <span class="token parameter variable">--tls</span> <span class="token parameter variable">--cafile</span> /etc/hyperledger/fabric/crypto-config/ordererOrganizations/example.com/orderers/orderer0.example.com/msp/tlscacerts/tlsca.example.com-cert.pem
</code></pre></div><p>org2 更新锚节点：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">CORE_PEER_TLS_ENABLED</span><span class="token operator">=</span>true
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CORE_PEER_LOCALMSPID</span><span class="token operator">=</span><span class="token string">&quot;Org2MSP&quot;</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CORE_PEER_TLS_ROOTCERT_FILE</span><span class="token operator">=</span>/etc/hyperledger/fabric/crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CORE_PEER_MSPCONFIGPATH</span><span class="token operator">=</span>/etc/hyperledger/fabric/crypto-config/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CORE_PEER_ADDRESS</span><span class="token operator">=</span>peer0.org2.example.com:9051

peer channel update <span class="token parameter variable">-o</span> orderer0.example.com:7050 <span class="token parameter variable">-c</span> businesschannel <span class="token parameter variable">-f</span> /tmp/channel-artifacts/Org2MSPanchors.tx <span class="token parameter variable">--tls</span> <span class="token parameter variable">--cafile</span> /etc/hyperledger/fabric/crypto-config/ordererOrganizations/example.com/orderers/orderer0.example.com/msp/tlscacerts/tlsca.example.com-cert.pem
</code></pre></div><p>锚节点配置更新后，同一通道内不同组织之间的 Peer 也可以进行 Gossip 通信，共同维护通道账本。后续，用户可以通过智能合约使用通道账本。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">3 天前</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blockchain/Fabric/3_部署 peer 节点.html" class="prev">
        二进制安装部署 Peer 节点
      </a></span> <span class="next"><a href="/blockchain/Fabric/5_链码的安装与调用.html">
        安装链码
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.d06c6709.js" defer></script><script src="/assets/js/2.58244656.js" defer></script><script src="/assets/js/1.6ba70183.js" defer></script><script src="/assets/js/29.f41b1a18.js" defer></script>
  </body>
</html>
