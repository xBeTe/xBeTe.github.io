(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{307:function(a,e,s){"use strict";s.r(e);var r=s(14),t=Object(r.a)({},(function(){var a=this,e=a._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"安装链码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装链码"}},[a._v("#")]),a._v(" 安装链码")]),a._v(" "),e("h2",{attrs:{id:"打包链码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#打包链码"}},[a._v("#")]),a._v(" 打包链码")]),a._v(" "),e("p",[a._v("在宿主机和 docker cli 容器挂载的 "),e("code",[a._v("chaincodes")]),a._v("目录下下载合约代码：")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("git")]),a._v(" clone https://gitee.com/kernelHP/hyperledger-fabric-contract-java-demo.git\n\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" hyperledger-fabric-contract-java-demo/\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 切换到视频中的指定分支")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("git")]),a._v(" checkout 25d328c2fb5c28fb7f8001c5bbb350f7f098f0b3 \n\n")])])]),e("p",[a._v("编译打包源码：")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("mvn compile package "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-DskipTests")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-Dmaven.test.skip")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("true\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("mv")]),a._v(" target/chaincode.jar "),e("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("$PWD")]),a._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 删除编译后产生的 target 目录； src 源代码目录； pom.xml")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-rf")]),a._v(" target/ src pom.xml\n")])])]),e("p",[a._v("得到如下结构目录:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("hyperledger-fabric-contract-java-demo/\n├── chaincode.jar\n├── collections_config.json\n├── META-INF\n│   └── statedb\n│       └── couchdb\n│           └── indexes\n│               └── indexNameColor.json\n")])])]),e("p",[a._v("进入 cli 容器：")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-it")]),a._v(" fabric-cli "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("bash")]),a._v("\n")])])]),e("h3",{attrs:{id:""}},[e("a",{staticClass:"header-anchor",attrs:{href:"#"}},[a._v("#")])]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("peer lifecycle chaincode package hyperledger-fabric-contract-java-demo.tar.gz "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--path")]),a._v(" /etc/hyperledger/fabric/chaincodes/hyperledger-fabric-contract-java-demo/ "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--lang")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("java")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--label")]),a._v(" hyperledger-fabric-contract-java-demo_1\n")])])]),e("h2",{attrs:{id:"在-peer-节点安装链码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#在-peer-节点安装链码"}},[a._v("#")]),a._v(" 在 peer 节点安装链码")]),a._v(" "),e("p",[a._v("org1-peer0 节点：")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("CORE_PEER_TLS_ENABLED")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("true\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("CORE_PEER_LOCALMSPID")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Org1MSP"')]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("CORE_PEER_TLS_ROOTCERT_FILE")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("CORE_PEER_MSPCONFIGPATH")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("CORE_PEER_ADDRESS")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("peer0.org1.example.com:7051\n\npeer lifecycle chaincode "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" hyperledger-fabric-contract-java-demo.tar.gz\n")])])]),e("p",[a._v("结果如下：")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("020 02-18 03:26:06.78 UTC"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("cli.lifecycle.chaincode"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" submitInstallProposal -"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" INFO Installed remotely: response:"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("status:200 payload:"),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),e("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[a._v("\\n")]),a._v("hhyperledger-fabric-contract-java-demo_1:bbc6a881b7cf349cd608a608d32e638b546341575e48614524761ab51fc6a457"),e("span",{pre:!0,attrs:{class:"token entity",title:"\\022"}},[a._v("\\022")]),a._v("'hyperledger-fabric-contract-java-demo_1\"")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" \n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("021 02-18 03:26:06.78 UTC"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("cli.lifecycle.chaincode"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" submitInstallProposal -"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" INFO Chaincode code package identifier: hyperledger-fabric-contract-java-demo_1:bbc6a881b7cf349cd608a608d32e638b546341575e48614524761ab51fc6a457\n")])])]),e("p",[a._v("org1-peer1 节点:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("CORE_PEER_TLS_ENABLED")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("true\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("CORE_PEER_LOCALMSPID")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Org1MSP"')]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("CORE_PEER_TLS_ROOTCERT_FILE")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/tls/ca.crt\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("CORE_PEER_MSPCONFIGPATH")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("CORE_PEER_ADDRESS")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("peer1.org1.example.com:8051\n\npeer lifecycle chaincode "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" hyperledger-fabric-contract-java-demo.tar.gz\n")])])]),e("p",[a._v("org2-peer0 节点:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("CORE_PEER_TLS_ENABLED")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("true\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("CORE_PEER_LOCALMSPID")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Org2MSP"')]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("CORE_PEER_TLS_ROOTCERT_FILE")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/etc/hyperledger/fabric/crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("CORE_PEER_MSPCONFIGPATH")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/etc/hyperledger/fabric/crypto-config/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("CORE_PEER_ADDRESS")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("peer0.org2.example.com:9051\n\npeer lifecycle chaincode "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" hyperledger-fabric-contract-java-demo.tar.gz\n")])])]),e("p",[a._v("org2-peer1 节点:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("CORE_PEER_TLS_ENABLED")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("true\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("CORE_PEER_LOCALMSPID")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Org2MSP"')]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("CORE_PEER_TLS_ROOTCERT_FILE")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/etc/hyperledger/fabric/crypto-config/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/tls/ca.crt\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("CORE_PEER_MSPCONFIGPATH")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/etc/hyperledger/fabric/crypto-config/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("CORE_PEER_ADDRESS")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("peer1.org2.example.com:10051\n\npeer lifecycle chaincode "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" hyperledger-fabric-contract-java-demo.tar.gz\n")])])]),e("p",[a._v("查询包 ID:")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("peer lifecycle chaincode queryinstalled\n")])])]),e("p",[a._v("包 ID 是链码标签和链码二进制文件的哈希值的组合。每个 peer 节点将生成相同的包 ID。你应该看到类似于以下内容的输出：")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("Installed chaincodes on peer:\nPackage ID: hyperledger-fabric-contract-java-demo_1:5322394b54afed067a8ebb3e47273a1a72b1c8648d8afdc7165d163cc1cc8470, Label: hyperledger-fabric-contract-java-demo_1\n")])])]),e("p",[a._v("将包 ID 保存为环境变量:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("CC_PACKAGE_ID")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("hyperledger-fabric-contract-java-demo_1:2d0c7089ca98b3e1daf7d0b013808b6985d64581ed4797b7a1122d7e3f41bba5\n")])])]),e("h2",{attrs:{id:"批准链码定义"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#批准链码定义"}},[a._v("#")]),a._v(" 批准链码定义")]),a._v(" "),e("p",[a._v("org1 批准链码定义:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("CORE_PEER_TLS_ENABLED")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("true\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("CORE_PEER_LOCALMSPID")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Org1MSP"')]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("CORE_PEER_TLS_ROOTCERT_FILE")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("CORE_PEER_MSPCONFIGPATH")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("CORE_PEER_ADDRESS")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("peer0.org1.example.com:7051\n\npeer lifecycle chaincode approveformyorg "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" orderer0.example.com:7050 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--ordererTLSHostnameOverride")]),a._v(" orderer0.example.com "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--channelID")]),a._v(" businesschannel "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" hyperledger-fabric-contract-java-demo "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--version")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("1.0")]),a._v(" --package-id "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$CC_PACKAGE_ID")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--sequence")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--tls")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--cafile")]),a._v(" /etc/hyperledger/fabric/crypto-config/ordererOrganizations/example.com/orderers/orderer0.example.com/msp/tlscacerts/tlsca.example.com-cert.pem\n")])])]),e("p",[a._v("结果如下：")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("025 02-18 05:37:12.44 UTC"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("chaincodeCmd"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" ClientWait -"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" INFO txid "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("895c0d4b9eee30419e068072b816906f660c1f9ddb7400b63d6892a001470c38"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" committed with status "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("VALID"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" at peer0.org1.example.com:7051\n")])])]),e("p",[a._v("org2 批准链码定义:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("CORE_PEER_TLS_ENABLED")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("true\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("CORE_PEER_LOCALMSPID")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Org2MSP"')]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("CORE_PEER_TLS_ROOTCERT_FILE")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/etc/hyperledger/fabric/crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("CORE_PEER_MSPCONFIGPATH")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/etc/hyperledger/fabric/crypto-config/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("CORE_PEER_ADDRESS")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("peer0.org2.example.com:9051\n\npeer lifecycle chaincode approveformyorg "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" orderer0.example.com:7050 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--ordererTLSHostnameOverride")]),a._v(" orderer0.example.com "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--channelID")]),a._v(" businesschannel "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" hyperledger-fabric-contract-java-demo "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--version")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("1.0")]),a._v(" --package-id "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$CC_PACKAGE_ID")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--sequence")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--tls")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--cafile")]),a._v(" /etc/hyperledger/fabric/crypto-config/ordererOrganizations/example.com/orderers/orderer0.example.com/msp/tlscacerts/tlsca.example.com-cert.pem\n")])])]),e("p",[a._v("检查通道成员是否已批准相同的链码定义：")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("peer lifecycle chaincode checkcommitreadiness "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--channelID")]),a._v(" businesschannel "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" hyperledger-fabric-contract-java-demo "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--version")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("1.0")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--sequence")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--tls")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--cafile")]),a._v(" /etc/hyperledger/fabric/crypto-config/ordererOrganizations/example.com/orderers/orderer0.example.com/msp/tlscacerts/tlsca.example.com-cert.pem "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--output")]),a._v(" json\n")])])]),e("p",[a._v("将链码提交到通道:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("peer lifecycle chaincode commit "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" orderer0.example.com:7050 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--ordererTLSHostnameOverride")]),a._v(" orderer0.example.com "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--channelID")]),a._v(" businesschannel "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" hyperledger-fabric-contract-java-demo "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--version")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("1.0")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--sequence")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--tls")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--cafile")]),a._v(" /etc/hyperledger/fabric/crypto-config/ordererOrganizations/example.com/orderers/orderer0.example.com/msp/tlscacerts/tlsca.example.com-cert.pem "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--peerAddresses")]),a._v(" peer0.org1.example.com:7051 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--tlsRootCertFiles")]),a._v(" /etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--peerAddresses")]),a._v(" peer0.org2.example.com:9051 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--tlsRootCertFiles")]),a._v(" /etc/hyperledger/fabric/crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt\n")])])]),e("p",[a._v("结果如下：")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("029 02-18 05:50:47.62 UTC"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("chaincodeCmd"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" ClientWait -"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" INFO txid "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("2c06365cd94ebcc95e4fc6e5a5334aafda35e874bf894ef604fd3a9fe18d86be"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" committed with status "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("VALID"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" at peer0.org2.example.com:7051\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("02a 02-18 05:50:47.81 UTC"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("chaincodeCmd"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" ClientWait -"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" INFO txid "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("2c06365cd94ebcc95e4fc6e5a5334aafda35e874bf894ef604fd3a9fe18d86be"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" committed with status "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("VALID"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" at peer0.org1.example.com:7051\n")])])]),e("p",[a._v("用 "),e("code",[a._v("peer lifecycle chaincode querycommitted")]),a._v(" 命令来确认链码定义已提交给通道:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("peer lifecycle chaincode querycommitted "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--channelID")]),a._v(" businesschannel "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" hyperledger-fabric-contract-java-demo "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--cafile")]),a._v(" /etc/hyperledger/fabric/crypto-config/ordererOrganizations/example.com/orderers/orderer0.example.com/msp/tlscacerts/tlsca.example.com-cert.pem\n")])])]),e("p",[a._v("结果如下：")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("Committed chaincode definition "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" chaincode "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v("'hyperledger-fabric-contract-java-demo'")]),a._v(" on channel "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v("'businesschannel'")]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v("\nVersion: "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("1.0")]),a._v(", Sequence: "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(", Endorsement Plugin: escc, Validation Plugin: vscc, Approvals: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("Org1MSP: true, Org2MSP: true"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n")])])]),e("h2",{attrs:{id:"调用链码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#调用链码"}},[a._v("#")]),a._v(" 调用链码")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 调用 createCat 函数")]),a._v("\npeer chaincode invoke "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" orderer0.example.com:7050 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--ordererTLSHostnameOverride")]),a._v(" orderer0.example.com "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--tls")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--cafile")]),a._v(" /etc/hyperledger/fabric/crypto-config/ordererOrganizations/example.com/orderers/orderer0.example.com/msp/tlscacerts/tlsca.example.com-cert.pem "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-C")]),a._v(" businesschannel "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-n")]),a._v(" hyperledger-fabric-contract-java-demo "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--peerAddresses")]),a._v(" peer0.org1.example.com:7051 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--tlsRootCertFiles")]),a._v(" /etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--peerAddresses")]),a._v(" peer0.org2.example.com:9051 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--tlsRootCertFiles")]),a._v(" /etc/hyperledger/fabric/crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('\'{"function":"createCat","Args":["cat-0" , "tom" ,  "3" , "蓝色" , "大懒猫"]}\'')]),a._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 调用 queryCat 函数")]),a._v("\npeer chaincode query "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-C")]),a._v(" businesschannel "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-n")]),a._v(" hyperledger-fabric-contract-java-demo "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('\'{"Args":["queryCat" , "cat-0"]}\'')]),a._v("\n")])])])])}),[],!1,null,null,null);e.default=t.exports}}]);