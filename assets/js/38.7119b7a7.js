(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{318:function(s,a,t){"use strict";t.r(a);var e=t(14),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"vuepress-项目使用-nginx-在云服务器中部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vuepress-项目使用-nginx-在云服务器中部署"}},[s._v("#")]),s._v(" VuePress 项目使用 nginx 在云服务器中部署")]),s._v(" "),a("blockquote",[a("ul",[a("li",[s._v("本站使用 "),a("a",{attrs:{href:"https://vuepress.vuejs.org/zh/",target:"_blank",rel:"noopener noreferrer"}},[s._v("VuePress"),a("OutboundLink")],1),s._v(" 构建，官方文档提供了"),a("a",{attrs:{href:"https://vuepress.vuejs.org/zh/guide/deploy.html",target:"_blank",rel:"noopener noreferrer"}},[a("code",[s._v("CloudBase")]),s._v("、"),a("code",[s._v("GitHub Pages")]),s._v(" 等多个平台的部署"),a("OutboundLink")],1),s._v("，本文主要介绍在自己的服务器中使用 nginx 进行部署。")]),s._v(" "),a("li",[s._v("自动化部署部分"),a("a",{attrs:{href:"https://juejin.cn/post/6948994029254082567",target:"_blank",rel:"noopener noreferrer"}},[s._v("参考文章"),a("OutboundLink")],1)])])]),s._v(" "),a("p",[s._v("准备工作：")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("Linux 云服务器（最好购买域名，可以使用域名进行访问），云服务安全组入站规则中放行 "),a("code",[s._v("80")]),s._v(" 端口（ "),a("code",[s._v("http")]),s._v(" 默认端口，若使用 "),a("code",[s._v("https")]),s._v(" 放行 "),a("code",[s._v("443")]),s._v(" 端口）")])]),s._v(" "),a("li",[a("p",[s._v("使用 git 管理的 VuePress 项目")])])]),s._v(" "),a("h2",{attrs:{id:"服务器配置-nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务器配置-nginx"}},[s._v("#")]),s._v(" 服务器配置 nginx")]),s._v(" "),a("h3",{attrs:{id:"安装-nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装-nginx"}},[s._v("#")]),s._v(" 安装 nginx")]),s._v(" "),a("p",[s._v("安装方式：")]),s._v(" "),a("ul",[a("li",[s._v("RPM")]),s._v(" "),a("li",[s._v("Yum（CentOS）")]),s._v(" "),a("li",[s._v("Docker")]),s._v(" "),a("li",[s._v("源码安装")])]),s._v(" "),a("p",[s._v("RPM、Yum 以及 Docker安装方式自行搜索，本文主要介绍源码安装方式，虽然过程繁琐，但服务性能好，且方便配置。")]),s._v(" "),a("h4",{attrs:{id:"准备工作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#准备工作"}},[s._v("#")]),s._v(" 准备工作")]),s._v(" "),a("p",[s._v("手动创建 nginx 用户和用户组")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("groupadd")]),s._v(" nginx\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" nginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-g")]),s._v(" nginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" /sbin/nologin "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-M")]),s._v("\n")])])]),a("blockquote",[a("p",[s._v("使用非root用户运行 nginx，防止直接从服务器 80 端口获取到 root 用户权限")])]),s._v(" "),a("h4",{attrs:{id:"安装依赖环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装依赖环境"}},[s._v("#")]),s._v(" 安装依赖环境")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" gcc-c++ pcre pcre-devel zlib zlib-devel openssl openssl-devel\n")])])]),a("h4",{attrs:{id:"下载-nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#下载-nginx"}},[s._v("#")]),s._v(" 下载 nginx")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://nginx.org/en/download.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("nginx 官网"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("可以到官网下载后，上传服务器。")]),s._v(" "),a("p",[s._v("也可以直接在服务器上下载：")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" http://nginx.org/download/nginx-1.25.1.tar.gz\n")])])]),a("blockquote",[a("p",[a("code",[s._v("wget")]),s._v("后面的链接为官网下载链接，可以选择自己想要下载的版本的链接")])]),s._v(" "),a("h4",{attrs:{id:"解压"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解压"}},[s._v("#")]),s._v(" 解压")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-zxvf")]),s._v(" nginx-1.25.1.tar.gz\n")])])]),a("h4",{attrs:{id:"编译"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编译"}},[s._v("#")]),s._v(" 编译")]),s._v(" "),a("p",[s._v("安装前配置")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" nginx-1.25.1\n\n./configure "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--prefix")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--user")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--group")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx\n")])])]),a("blockquote",[a("p",[s._v("参数说明：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("--prefix=/usr/local/nginx")]),s._v(" 编译安装目录（默认 "),a("code",[s._v("/usr/local/nginx")]),s._v("）")]),s._v(" "),a("li",[a("code",[s._v("–-user=nginx")]),s._v(" 所属用户nginx")]),s._v(" "),a("li",[a("code",[s._v("—-group=nginx")]),s._v(" 所属组nginx")]),s._v(" "),a("li",[a("code",[s._v("–-with-http_stub_status_module")]),s._v("该模块提供nginx的基本状态信息")]),s._v(" "),a("li",[a("code",[s._v("–-with-http_ssl_module")]),s._v(" 支持HTTPS")])])]),s._v(" "),a("p",[s._v("编译并安装")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" \n")])])]),a("h3",{attrs:{id:"配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[s._v("#")]),s._v(" 配置")]),s._v(" "),a("h4",{attrs:{id:"将-nginx-配置为全局命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#将-nginx-配置为全局命令"}},[s._v("#")]),s._v(" 将 "),a("code",[s._v("nginx")]),s._v(" 配置为全局命令")]),s._v(" "),a("p",[s._v("编辑环境变量")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/profile\n")])])]),a("p",[s._v("加入")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),s._v(":/usr/local/nginx/sbin\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")]),s._v("\n")])])]),a("p",[s._v("或者使用软链接的方式")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" /usr/local/nginx/sbin/nginx /usr/local/bin/\n")])])]),a("h4",{attrs:{id:"修改配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改配置文件"}},[s._v("#")]),s._v(" 修改配置文件")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /usr/local/nginx/conf/nginx.conf\n")])])]),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# user nobody 修改为： ")]),s._v("\nuser nginx nginx\n")])])]),a("p",[s._v("启动 nginx")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检查配置文件")]),s._v("\nnginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动 nginx")]),s._v("\nnginx\n")])])]),a("p",[s._v("此时如果启动没有问题，在浏览器中访问："),a("code",[s._v("http://服务器IP或域名")]),s._v(" 能看到 nginx 默认页面")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://mydoc-pics.oss-cn-chengdu.aliyuncs.com/img/f0ffdfd9c6_default_page.jpg",alt:"如何在 Ubuntu 22.04 上安装 Nginx_nginx_weixin_0010034-Linux"}})]),s._v(" "),a("h4",{attrs:{id:"配置-nginx-工作目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置-nginx-工作目录"}},[s._v("#")]),s._v(" 配置 nginx 工作目录")]),s._v(" "),a("p",[s._v("nginx 默认页面存放在 "),a("code",[s._v("/usr/local/nginx/html")]),s._v(" 中，我们可新建自己的页面存放目录并配置到 nginx 中")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /var/www/html\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 给 nginx 用户操作目录权限")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" nginx:nginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-R")]),s._v(" /var/www\n")])])]),a("p",[s._v("修改 nginx 配置文件：")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# HTTP server\nserver {\n   listen       80;\n   server_name  www.yourdomain.me yourdomain.me;\n  \n   location / {\n       root   /var/www/html;\n       index  index.html index.htm;\n   }\n}\n\n# HTTPS server\nserver {\n    listen       443 ssl;\n    server_name  www.yourdomain.me yourdomain.me;\n    ssl_certificate      /server.pem;\n    ssl_certificate_key  /private.key;\n\n    ssl_session_cache    shared:SSL:1m;\n    ssl_session_timeout  5m;\n\n    ssl_ciphers  HIGH:!aNULL:!MD5;\n    ssl_prefer_server_ciphers  on;\n\n    location / {\n        root   /var/www/html;\n        index  index.html index.htm;\n    }\n}\n\n")])])]),a("p",[s._v("此时将 VuePress 项目构建后 "),a("code",[s._v("dist")]),s._v(" 目录下文件上传至 "),a("code",[s._v("/var/www/html/")]),s._v(" 目录下便能访问你的项目，但如果希望能够像 "),a("code",[s._v("GitHub Page")]),s._v(" 一样，通过一条命令部署，还需要接着操作。")]),s._v(" "),a("h2",{attrs:{id:"服务器配置-git"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务器配置-git"}},[s._v("#")]),s._v(" 服务器配置 git")]),s._v(" "),a("h3",{attrs:{id:"创建并配置-git-用户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建并配置-git-用户"}},[s._v("#")]),s._v(" 创建并配置 git 用户")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" adduser "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("su")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v("\n")])])]),a("h3",{attrs:{id:"服务器配置ssh-key"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务器配置ssh-key"}},[s._v("#")]),s._v(" 服务器配置SSH key")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" .ssh "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("700")]),s._v(" .ssh\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" .ssh/authorized_keys "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" .ssh/authorized_keys\n")])])]),a("p",[s._v("配置好以后，我们就相当于使用 git 用户来进行操作了。")]),s._v(" "),a("p",[s._v("复制本地配置的 ssh 访问 git 的公钥，粘贴至 "),a("code",[s._v("~/.ssh/authorized_keys")])]),s._v(" "),a("blockquote",[a("p",[s._v("获取公钥的方法：")]),s._v(" "),a("ul",[a("li",[s._v("打开"),a("code",[s._v("git bash")])]),s._v(" "),a("li",[s._v("执行生成公钥和私钥的命令: "),a("code",[s._v("ssh-keygen -t rsa")])]),s._v(" "),a("li",[s._v("在用户目录下的.ssh 文件夹中，会有公钥和私钥，将公钥复制到服务器的"),a("code",[s._v("authorized_keys")]),s._v("文件中。")])])]),s._v(" "),a("p",[s._v("这样做的目的就是，以后由本地向服务器提交资源，就不需要再进行身份验证了。")]),s._v(" "),a("h3",{attrs:{id:"创建仓库与目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建仓库与目录"}},[s._v("#")]),s._v(" 创建仓库与目录")]),s._v(" "),a("p",[s._v("找一个地方创建 git 仓库，比如在"),a("code",[s._v("/home/git")]),s._v("下创建"),a("code",[s._v("blog.git")]),s._v("文件夹，作为 git 仓库:")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /home/git\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /home/git\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" blog.git\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" blog.git\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" init "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--bare")]),s._v("\n")])])]),a("p",[s._v("创建临时目录")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /home/tmp\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /home/tmp/blog\n")])])]),a("h3",{attrs:{id:"给-git-用户操作目录权限"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#给-git-用户操作目录权限"}},[s._v("#")]),s._v(" 给 git 用户操作目录权限")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" git:git "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-R")]),s._v(" /var/www\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" git:git "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-R")]),s._v(" /home/tmp\n")])])]),a("h3",{attrs:{id:"配置-hooks"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置-hooks"}},[s._v("#")]),s._v(" 配置 hooks")]),s._v(" "),a("p",[s._v("进入创建的 git 仓库")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("cd /home/git/blog.git/hooks\n")])])]),a("p",[s._v("然后修改"),a("code",[s._v("post-update.sample")]),s._v("文件，并将其改名为"),a("code",[s._v("post-update")]),s._v("，将其修改为如下脚本：")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" post-update.sample post-update\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" post-update\n")])])]),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/sh")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# An example hook script to prepare a packed repository for use over")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# dumb transports.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# To enable this hook, rename this file to "post-update".')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#exec git update-server-info")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Im update"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 代码仓库目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GIT_REPO")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/home/git/blog.git\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 临时目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TMP_GIT_CLONE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/home/tmp/blog\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Nginx的root目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PUBLIC_WWW")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/www/html\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rf")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${TMP_GIT_CLONE}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$GIT_REPO")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$TMP_GIT_CLONE")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rf")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${PUBLIC_WWW}")]),s._v("/*\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${PUBLIC_WWW}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${TMP_GIT_CLONE}")]),s._v("/*\n")])])]),a("h2",{attrs:{id:"本地项目配置自动部署脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#本地项目配置自动部署脚本"}},[s._v("#")]),s._v(" 本地项目配置自动部署脚本")]),s._v(" "),a("h3",{attrs:{id:"创建自动部署脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建自动部署脚本"}},[s._v("#")]),s._v(" 创建自动部署脚本")]),s._v(" "),a("p",[s._v("在 vuepress 项目根目录创建"),a("code",[s._v("deploy.sh")]),s._v("来运行自动部署命令")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 确保脚本抛出遇到的错误")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生成静态文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" run build\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入生成的文件夹")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" docs/.vuepress/dist\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果是发布到自定义域名")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# echo 'www.example.com' > CNAME")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" init\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-A")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" commit "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'deploy'")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果发布到 https://<USERNAME>.github.io")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#git push -f git@github.com:<USERNAME>/<USERNAME>.github.io.git master")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发布到云服务器")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" push "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" --set-upstream git@"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("服务器地址"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":/home/git/docs.git master\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果发布到 https://<USERNAME>.github.io/<REPO>")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#git push -f git@github.com:xBeTe/My_Docs.git master:gh-pages")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" -\n")])])]),a("h3",{attrs:{id:"在-package-json-中配置自动打包部署的命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在-package-json-中配置自动打包部署的命令"}},[s._v("#")]),s._v(" 在 package.json 中配置自动打包部署的命令")]),s._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"scripts"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"dev"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vuepress dev docs"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"build"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vuepress build docs"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"deploy"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sh ./deploy.sh"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("h3",{attrs:{id:"运行自动打包部署命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#运行自动打包部署命令"}},[s._v("#")]),s._v(" 运行自动打包部署命令")]),s._v(" "),a("p",[s._v("在项目根目录打开 "),a("code",[s._v("git bash")]),s._v(" 运行一下命令：")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" run deploy\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 或者")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yarn")]),s._v(" deploy\n")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);